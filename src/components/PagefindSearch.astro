---
// Pagefind search component
const isDev = import.meta.env.DEV;
---

{!isDev && <link href="/pagefind/pagefind-ui.css" rel="stylesheet">}
<div id="pagefind-search">
  {isDev && (
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      disabled
    />
  )}
</div>

{!isDev && (
  <script is:inline>
    (function() {
      if (typeof window !== 'undefined') {
        const script = document.createElement('script');
        script.src = '/pagefind/pagefind-ui.js';
        script.type = 'module';
        script.onload = function() {
          new window.PagefindUI({
            element: '#pagefind-search',
            showImages: false,
            showSubResults: true,
            translations: {
              placeholder: 'Search...',
            },
          });
        };
        script.onerror = function() {
          console.log('Pagefind not available - run build to enable search');
        };
        document.head.appendChild(script);
      }
    })();
  </script>
)}

<style>
  :global(#pagefind-search .pagefind-ui__form) {
    margin: 0;
  }

  :global(#pagefind-search .pagefind-ui__search-input) {
    border-radius: 0.375rem;
    border: 1px solid var(--bs-border-color);
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
  }

  :global(#pagefind-search .pagefind-ui__search-input:focus) {
    border-color: var(--bs-primary);
    outline: none;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }

  #pagefind-search input[disabled] {
    cursor: not-allowed;
    opacity: 0.6;
  }
</style>
